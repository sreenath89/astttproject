{% extends 'base.html' %}
{% load i18n %} 
{% block title %}{% trans "Daily Count of Windows & Windows/SQL Instances"%}{% endblock %} 
{% block main %}
<h1>{% trans "Daily Report of Windows/SQL Instances" %}</h1>

    <hr class="header_rule">
    <form id="sql-image-report-filter" class="form-inline">


        <label>&nbsp;&nbsp;&nbsp;Date (YYYY-MM-DD)&nbsp;</label>
        <label for="image-filter-period-from">From:</label>
        <input id="image-filter-period-from" class="form-control" type="date" required pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}" name="image_usage_period_from" value="{{ image_filter_period_from }}">

        <label for="image-filter-period-to">&nbsp;To:</label>
        <input id="image-filter-period-to" class="form-control" type="date" required pattern="[0-9]{4}-[0-9]{2}-[0-9]{2}" name="image_usage_period_to" value="{{ image_filter_period_to }}">
        &nbsp;&nbsp;
        <a id="image-filter-search" class="btn btn-default">
            <span class="fa fa-search search-icon"></span>&nbsp;Search&#8230;
        </a>
    </form>
    <script>

        /* search filter handler */
        function search_filter_handler () {
            // horizon admin invoices filter handler
            var url = '{{ admin_image_report_filter_endpoint }}'
            // show spinner
            horizon.modals.modal_spinner('Loading')
            // setup params
            var params = {
                'period_from': $('#image-filter-period-from').val(),
                'period_to': $('#image-filter-period-to').val()
            }
            console.log(params);
            // send filter params
            console.log('setting admin/billing/invoice filter: ', url)
            $.get(url, params).always(function () {
                // reload page
                location.reload();
            })
        }

        /* download helper */
        function download (url) {
            $('<iframe />')
                .attr('src', url)
                .hide()
                .appendTo('body');
        }

        /* export as dat handler */
        function export_as_handler (event) {
            var url = $(event.target).attr('href')
            // append invoice id for single download
            event.preventDefault()
            event.stopPropagation();
            // trick for hide dropdown
            $('body').trigger('click')
            download(url)
        }

        /* entry point (DOM ready) */
        $(document).ready(function () {
            /* setup even handlers */
            $('#image-filter-search').on('click', search_filter_handler)
        })
    </script>

<div class="col-sm-12 row detail">


	<dl class="dl-horizontal">
			<table class="table table-bordered table-striped" id="invoice">
				<thead>
					<tr class="table_caption">
						<th colspan="8" class="table_header" data-column="0">		    	
							<div class="table_actions clearfix"></div>
						</th>
					</tr>
					<tr class="tablesorter-headerRow">
						<th class="normal_column">Image Name</th>
                                                   {% for date_val in report_date_list %}
                                                       <th class="normal_column">{{ date_val }}</th>
                                                   {% endfor %}

					</tr>
				</thead>
				<tbody>
{% if user_data1 %}

    {% for key, value in user_data1.items %}
 
                                                        <tr> 
                                                                <td class="normal_column">{{key}}</td>
        {% for k, v in value.items|dictsort:"0.lower" %}
								<td class="normal_column">{{ v }}</td>
        {% endfor %}
							</tr>

    {% endfor %}

{% else %}
<tr>
<td>No data</td>
</tr>

{% endif %}

				</tbody>
			</table>
	</dl>
</div>

{% endblock %}

